

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>BSP &mdash; LED / Board Status Detection 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> LED / Board Status Detection
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">BSP</a><ul>
<li><a class="reference internal" href="#general-approach">General approach</a></li>
<li><a class="reference internal" href="#the-classes-of-the-bsp">The classes of the BSP</a></li>
<li><a class="reference internal" href="#board-orientation">Board Orientation</a></li>
<li><a class="reference internal" href="#homography-provider">Homography Provider</a></li>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">LED / Board Status Detection</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>BSP</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/entities/BSP.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="bsp">
<h1>BSP<a class="headerlink" href="#bsp" title="Permalink to this headline">¶</a></h1>
<div class="section" id="general-approach">
<h2>General approach<a class="headerlink" href="#general-approach" title="Permalink to this headline">¶</a></h2>
<p>Based on the reference image, features are extracted with SIFT and matched with ‘knn nearest’ in the target image.
The matching allows to calculate the homography matrix which describes the rotation and scaling difference between the
reference and target image. With the difference known, it is possible to calculate relative coordinates from the reference
into absolut coordinates in the target image. Consequently, the coordinates of the LEDs can be calculated and
regions of interest (ROI) can be extracted.</p>
<div class="figure align-default" id="id1">
<img alt="../_images/raspberryPiReferenceExample.jpg" src="../_images/raspberryPiReferenceExample.jpg" />
<p class="caption"><span class="caption-text">An example for a reference picture of a Raspberry Pi model B+
The image shows the board from above and is cropped to the corner points of the board. Such reference data can be
generated with the BDG and is necessary for providing the state of the board in a target image.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="the-classes-of-the-bsp">
<h2>The classes of the BSP<a class="headerlink" href="#the-classes-of-the-bsp" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="board-orientation">
<h2>Board Orientation<a class="headerlink" href="#board-orientation" title="Permalink to this headline">¶</a></h2>
<p>The board orientation object is responsible for the information associated with where the board is
in a target image. Naturally, if queried with new images this might not be true anymore as the board could have been
moved for instance.</p>
<p>For this the object has a timestamp of its creation indicating the time of the calculation, allowing to recalculate
the orientation after some time.</p>
<span class="target" id="module-src.BSP.BoardOrientation"></span><dl class="py class">
<dt id="src.BSP.BoardOrientation.BoardOrientation">
<em class="property">class </em><code class="sig-prename descclassname">src.BSP.BoardOrientation.</code><code class="sig-name descname">BoardOrientation</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">homography_matrix</span></em>, <em class="sig-param"><span class="n">corners</span></em>, <em class="sig-param"><span class="n">validity_seconds</span><span class="o">=</span><span class="default_value">3</span></em><span class="sig-paren">)</span><a class="headerlink" href="#src.BSP.BoardOrientation.BoardOrientation" title="Permalink to this definition">¶</a></dt>
<dd><p>Contains the orientation of a board.
On creation, a timestamp is alongside the homography matrix and the corners stored as well.
The validity seconds indicate how long the information this object provides shall be valid.</p>
<dl class="py method">
<dt id="src.BSP.BoardOrientation.BoardOrientation.check_if_outdated">
<code class="sig-name descname">check_if_outdated</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#src.BSP.BoardOrientation.BoardOrientation.check_if_outdated" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns whether the information of the object is still valid.
:return: True if since the creation time more than validity_seconds elapsed</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="homography-provider">
<h2>Homography Provider<a class="headerlink" href="#homography-provider" title="Permalink to this headline">¶</a></h2>
<p>The homography provider is responsible for providing the board orientation, especially the homography matrix which
is inside the BoardOrientation object.</p>
<span class="target" id="module-src.BSP.homographyProvider"></span><dl class="py function">
<dt id="src.BSP.homographyProvider.calc_scale">
<code class="sig-prename descclassname">src.BSP.homographyProvider.</code><code class="sig-name descname">calc_scale</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">crn_pts_src</span></em>, <em class="sig-param"><span class="n">crn_pts_dst</span></em><span class="sig-paren">)</span><a class="headerlink" href="#src.BSP.homographyProvider.calc_scale" title="Permalink to this definition">¶</a></dt>
<dd><p>calculates the x scale and y scaling of the image by a set of corner points
:param crn_pts_src: is a set of corner points of the source image,</p>
<blockquote>
<div><p>order of them should be LT, RT, LB, RB (L/R= Left/Right, T/B=Top/Botton)</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>crn_pts_dst</strong> – is a set of corner points of the source image,
order of them should be LT, RT, LB, RB (L/R= Left/Right, T/B=Top/Botton)</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a tuple (scale_x, scale_y)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="src.BSP.homographyProvider.get_led_roi">
<code class="sig-prename descclassname">src.BSP.homographyProvider.</code><code class="sig-name descname">get_led_roi</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">board_orientation</span></em>, <em class="sig-param"><span class="n">reference_hw</span></em>, <em class="sig-param"><span class="n">led_center</span></em><span class="sig-paren">)</span><a class="headerlink" href="#src.BSP.homographyProvider.get_led_roi" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><p>Returns the LEDs in the target image based on the homography matrix</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>board_orientation</strong> – The orientation of the board in a BoardOrientation object</p></li>
<li><p><strong>reference_hw</strong> – A tuple with the height and width of the reference board</p></li>
<li><p><strong>led_center</strong> – A numpy list with the x,y coordinates of the centers of the LEDs</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The LEDs in the target image as a list</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="src.BSP.homographyProvider.homography_by_sift">
<code class="sig-prename descclassname">src.BSP.homographyProvider.</code><code class="sig-name descname">homography_by_sift</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ref_img</span></em>, <em class="sig-param"><span class="n">target_img</span></em>, <em class="sig-param"><span class="n">distance_factor</span><span class="o">=</span><span class="default_value">0.85</span></em>, <em class="sig-param"><span class="n">display_result</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="#src.BSP.BoardOrientation.BoardOrientation" title="src.BSP.BoardOrientation.BoardOrientation">src.BSP.BoardOrientation.BoardOrientation</a><a class="headerlink" href="#src.BSP.homographyProvider.homography_by_sift" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the board orientation based on SIFT with knnMatch
:param ref_img: The reference image for the calculation
:param target_img: The target image for the calculation
:param distance_factor: Influences the max distance of the matches as per Loew’s ration test. A higher value means</p>
<blockquote>
<div><p>more distant matches are also included. The optimal value may differ based on the board and image</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>display_result</strong> – If true the result is plotted</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A BoardOrientation object which contains the homography matrix and the corners</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>Following example calculates the orientation of the board, translates relative cooridnates into
absolute in the target image and finally extracts the roi for the LEDs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Loading the reference image</span>
<span class="n">ref</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;referenceCropped.jpg&quot;</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_COLOR</span><span class="p">)</span>
<span class="c1">#Loading the target image</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;targetImage.jpg&quot;</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_COLOR</span><span class="p">)</span>
<span class="c1">#Calculate orientation of board in target</span>
<span class="n">board_orientation</span> <span class="o">=</span> <span class="n">homography_by_sift</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
<span class="n">led_centers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">38</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">57</span><span class="p">]])</span>
<span class="c1">#Extract ROI from target</span>
<span class="n">leds</span> <span class="o">=</span> <span class="n">get_led_roi</span><span class="p">(</span><span class="n">board_orientation</span><span class="p">,</span> <span class="p">(</span><span class="n">ref</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ref</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">led_centers</span><span class="p">)</span>
<span class="c1">#Show LEDs</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&quot;Led1&quot;</span><span class="p">,</span> <span class="n">leds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&quot;Led2&quot;</span><span class="p">,</span> <span class="n">leds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, christoph meyer

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>